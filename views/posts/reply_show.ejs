<!DOCTYPE html>
<html>

<head>
  <%- include('../partials/head') %>
  <script src="https://kit.fontawesome.com/3573fc872a.js" crossorigin="anonymous"></script>

</head>

<body>
  <%- include('../partials/nav') %>

  <div class="container mb-3">

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb p-1 pl-2 pr-2">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="/posts">Board</a></li>
        <li class="breadcrumb-item active" aria-current="page"><%= post.numId %>. <%= post.title %></li>
      </ol>
    </nav>

    <div class="card">
      <h5 class="card-header p-2" data-search-highlight="title"><%= post.numId %>. <%= post.title %></h5>
      <div class="row">

        <div class="col-md-7 col-lg-8 col-xl-9 order-sm-2 order-md-1">



          <% if(post.attachment) { %>
          <% for(var i = 0; i < post.attachment.length; i++){ %>
          <div class="ml-2">
            <small><i class="fas fa-save">

              </i> Attachment:
              <a href="/files/<%= post.attachment[i].serverFileName %>/<%= post.attachment[i].originalFileName %>">
                <%= post.attachment[i].originalFileName %>
              </a>
              (<%= util.bytesToSize(post.attachment[i].size) %>)</small>
          </div>
          <% } %>
          <% } %>
          <div class="post-body p-2" data-search-highlight="body"><%- post.body %></div>
        </div>

        <div class="col-md-5 col-lg-4 col-xl-3 order-sm-1 order-md-2">
          <div class="post-info card m-2 p-2">

            <div class="border-bottom pb-1 mb-1">
              <% if (post.private_check === true) { %>
              <div style="color: #FF0000"><span>대외비 문서입니다</span></div>
              <% } else { %>
              <div style="color: #000000"><span>일반 문서입니다</span></div>

              <% } %>
            </div>



            <div class="border-bottom pb-1 mb-1">
              <div><span>Author</span> : <span data-search-highlight="author"><%= post.author ? post.author.username : "" %></span></div>
              <div><span>Email</span> : <span><a href="<% post.author ? post.author.email : "" %>"><%= post.author ? post.author.email : "" %></a></span></div>
              <div><span>Views</span> : <span><%= post.views %></span></div>
            </div>

            <div><span>CODE</span> : <span><%= post.code %></span></div>

            <div class="border-bottom pb-1 mb-1">
              <div><span>접수번호</span> : <span><%= post.numId_daily %></span></div>
              <div><span>국가</span> : <span><%= post.nation %></span></div>
              <div><span>고객사</span> : <span><%= post.enterprise %></span></div>
              <div><span>CODE</span> : <span><%= post.code %></span></div>
              <div><span>내용구분</span> : <span><%= post.section %></span></div>
              <div><span>보낸이</span> : <span><%= post.sender %></span></div>
              <div><span>부서</span> : <span><%= post.sender_dept %></span></div>
            </div>



            <div><span>Created</span> : <span data-date-time="<%= post.createdAt %>"></span></div>
            <% if(post.updatedAt) { %>
            <div><span>Updated</span> : <span data-date-time="<%= post.updatedAt %>"></span></div>
            <% } %>
          </div>
        </div>

      </div>
    </div>


    <div class="card" style="margin-top:2%;">
      <h5 class="card-header p-2" data-search-highlight="title"><i class="fas fa-reply fa-rotate-180"></i> <%= post.re_title %></h5>
      <div class="col-md-7 col-lg-8 col-xl-9 order-sm-2 order-md-1">

        <% if(post.re_attachment) { %>
        <% for(var i = 0; i < post.re_attachment.length; i++){ %>
        <div class="ml-2">
          <small><i class="fas fa-save">

          </i> Attachment:
            <a href="/files/<%= post.re_attachment[i].serverFileName %>/<%= post.re_attachment[i].originalFileName %>">
              <%= post.re_attachment[i].originalFileName %>
            </a>
            (<%= util.bytesToSize(post.re_attachment[i].size) %>)</small>
        </div>
        <% } %>
        <% } %>
        <div class="post-body p-2" data-search-highlight="body"><%- post.re_body %></div>
      </div>

    </div>

    <div class="mt-3">
      <a class="btn btn-dark" href="/posts<%= getPostQueryString() %>">Back</a>

      <% console.log(currentUser.id)%>
        <% console.log(post.re_author) %>
      <!-- 권한 확인 -->
      <% if(isAuthenticated && post.re_author && (currentUser.id == post.re_author)){ %>
      <a class="btn btn-dark" href="/posts/<%= post._id %>/reply<%= getPostQueryString() %>">답글 수정</a>
      <form action="/posts/<%= post._id %>?_method=delete<%= getPostQueryString(true) %>" method="post" class="d-inline">
        <a class="btn btn-dark" href="javascript:void(0)" onclick="confirm('Do you want to delete this?')?this.parentElement.submit():null;">답글 삭제</a>
      </form>
      <% } %>


    </div>



  </div>
</body>

</html>
